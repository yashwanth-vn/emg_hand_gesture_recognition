<!DOCTYPE html>
<html>

<head>
    <title>EMG Neural Interface</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap"
        rel="stylesheet">
    <!-- Cache busting -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}?v={{ range(1, 10000) | random }}">
    <style>
        /* Loading screen */
        #loader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #050508;
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #00f5d4;
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>

<body>
    <div id="loader">Loading Neural Interface...</div>

    <div class="bg-grid"></div>
    <div class="bg-glow"></div>

    <div class="container">
        <header>
            <div class="logo">
                <div class="logo-icon">üß†</div>
                <h1>EMG Neural Interface</h1>
            </div>
            <p class="subtitle">Real-Time Gesture Recognition ‚Ä¢ Virtual Control System</p>
        </header>

        <div class="main-grid">
            <!-- Left Panel -->
            <div class="panel">
                <div class="tabs">
                    <div class="tab active" onclick="showTab('detect')">‚ö° Detect</div>
                    <div class="tab" onclick="showTab('upload')">üìÅ CSV</div>
                </div>

                <div id="detect-panel">
                    <p class="panel-title">Signal Detection</p>
                    <button class="btn btn-primary" onclick="detectRandom()">
                        üé≤ Detect Gesture
                    </button>
                    <button class="btn btn-secondary" id="btn-auto" onclick="toggleAuto()">
                        ‚ñ∂ Start Auto-Detect
                    </button>
                    <!--
                    <button class="btn btn-secondary" onclick="resetCalibration()">
                        üéØ Calibrate
                    </button>
                    -->
                </div>

                <div id="upload-panel" class="hidden">
                    <p class="panel-title">CSV Playback</p>
                    <div class="upload-zone" onclick="document.getElementById('file').click()">
                        <p>üìä Upload CSV File</p>
                        <p style="font-size:11px; color:#444; margin-top:8px;">8 EMG channels per row</p>
                    </div>
                    <input type="file" id="file" accept=".csv" style="display:none" onchange="loadFile(this)">
                    <div id="file-status"></div>
                    <div id="playback" class="hidden">
                        <button class="btn btn-primary" id="btn-play" onclick="startPlayback()">‚ñ∂ Play</button>
                        <button class="btn btn-secondary" id="btn-stop" onclick="stopPlayback()" disabled>‚èπ
                            Stop</button>
                        <div class="progress-bar">
                            <div class="progress-fill" id="prog-bar"></div>
                        </div>
                        <div class="progress-text" id="prog-text">0 / 0</div>
                    </div>
                </div>

                <div id="status">Ready</div>
            </div>

            <!-- Center Section -->
            <div class="center-section">
                <!-- Bulb + Gesture Panel -->
                <div class="panel bulb-panel">
                    <div class="gesture-display">
                        <div class="gesture-icon-container" id="gesture-container">
                            <span id="icon">‚úã</span>
                        </div>
                        <div class="gesture-name rest" id="name">REST</div>
                        <div class="action-badge" id="action">IDLE</div>
                    </div>

                    <div class="bulb-wrapper">
                        <p class="panel-title" style="justify-content: center;">Virtual Bulb Control</p>
                        <div class="confidence-ring-container">
                            <div class="confidence-ring">
                                <svg width="200" height="200">
                                    <defs>
                                        <linearGradient id="confGradLow" x1="0%" y1="0%" x2="100%" y2="0%">
                                            <stop offset="0%" style="stop-color:#ff4466" />
                                            <stop offset="100%" style="stop-color:#ff6644" />
                                        </linearGradient>
                                        <linearGradient id="confGradMed" x1="0%" y1="0%" x2="100%" y2="0%">
                                            <stop offset="0%" style="stop-color:#ffaa00" />
                                            <stop offset="100%" style="stop-color:#ffcc00" />
                                        </linearGradient>
                                        <linearGradient id="confGradHigh" x1="0%" y1="0%" x2="100%" y2="0%">
                                            <stop offset="0%" style="stop-color:#00cc66" />
                                            <stop offset="100%" style="stop-color:#00ff88" />
                                        </linearGradient>
                                    </defs>
                                    <circle class="ring-bg" cx="100" cy="100" r="90" />
                                    <circle class="ring-fg" id="conf-ring" cx="100" cy="100" r="90" />
                                </svg>
                            </div>
                            <div class="bulb-container">
                                <div class="bulb" id="bulb"></div>
                                <div class="bulb-base"></div>
                            </div>
                        </div>
                        <div class="bulb-status off" id="bulb-status">OFF</div>
                    </div>
                </div>

                <!-- Channel Activity Bars -->
                <div class="panel channel-bars-section">
                    <p class="panel-title">Channel Activity</p>
                    <div class="channel-bars-container" id="channel-bars">
                        <!-- Generated by JS -->
                    </div>
                </div>

                <!-- EMG Waveform -->
                <div class="panel waveform-section">
                    <p class="panel-title">EMG Waveform</p>
                    <canvas class="waveform-canvas" id="waveform"></canvas>
                    <div class="wave-legend" id="legend"></div>
                </div>
            </div>

            <!-- Right Panel -->
            <div class="panel">
                <p class="panel-title">Performance</p>
                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-value" id="lat">--</div>
                        <div class="metric-label">Latency ms</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="conf-text">--</div>
                        <div class="metric-label">Confidence</div>
                    </div>
                </div>

                <p class="panel-title">Model Consensus</p>
                <div class="vote-card">
                    <span class="vote-name">Random Forest</span>
                    <span class="vote-value" id="v-rf">--</span>
                </div>
                <div class="vote-card">
                    <span class="vote-name">Gradient Boost</span>
                    <span class="vote-value" id="v-hgb">--</span>
                </div>
                <div class="vote-card">
                    <span class="vote-name">Logistic Regression</span>
                    <span class="vote-value" id="v-lr">--</span>
                </div>
            </div>
        </div>
    </div>
    <script src="{{ url_for('static', filename='js/app.js') }}?v={{ range(1, 10000) | random }}"></script>
</body>

</html>